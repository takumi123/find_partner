1. システム概要
本システムは「婚活エンジニア」の恋愛力向上を支援するWebアプリケーションのデモ版です。デモ版のためユーザー管理、ログイン、ログアウトは行いません。
ユーザーはWeb上で動画をアップロードし、その動画をVertex AIのGemini APIで自動分析します。分析結果は恋愛評価項目に基づくスコアやコメント、総合評価等の構造化データとして返却され、これらを画面上で確認可能です。
また、管理者機能（評価項目とプロンプトの編集）も同一画面上で提供します。ユーザー／管理者の区別はせず、アクセスした者はすべての機能を利用可能とします（デモ用簡易仕様）。

2. システム要件
機能一覧
項目	内容
ユーザー関連	デモ版のためユーザー管理なし。匿名利用。ログイン不要。
動画アップロード	ローカル環境から動画を手動アップロード可能。アップロード後、Gemini APIにて分析を開始。
分析結果確認	アップロード済み動画の分析結果一覧・詳細を確認可能。動画再生や評価結果（JSON）をテーブル表示。
評価項目編集	恋愛評価項目（点数と評価コメント）をWeb画面から追加・編集・削除可能。
プロンプト編集	Gemini APIに渡すプロンプト（評価基準や出力形式）をWeb画面から変更可能。

共通機能・前提条件
動画分析: Vertex AI Gemini APIを用いて動画から直接評価用データを構造化形式で取得する。
結果表示: 分析完了後、ダッシュボード画面に結果を表示。個別動画詳細画面では各項目の詳細やグラフを表示。
データ保存: DBには分析結果のJSON、動画URL、分析日時等を保存。動画ファイル本体はアップロード後、分析実行後に削除（ストレージ上に長期保存しない）。
環境: Vercel上で動作（目安：月額約3500円）。サーバーレス環境。
フロントエンド: React等を想定し、シンプルなUIでデモ性を重視。
エラーハンドリング: API実行失敗時やGemini APIから想定外の出力が来た場合にメッセージ表示。
スケーラビリティ: Vercelサーバーレス環境でスケール容易。デモ版のため負荷は限定的。
セキュリティ: デモ版のため最低限。閲覧者全員が管理操作可能。認証なし。
分析完了通知: 分析処理は非同期で行い、完了後フロント側からのポーリング、またはページリロードで結果表示。

3. システム構成図
mermaid
graph LR
    A[ユーザー(匿名利用)] --> B[Webアプリ];
    B --> F[Vertex AI Gemini API];
    F -->|分析結果| B
    B --> G[DB]
    A -->|動画アップロード| B
    B -->|動画URL,結果| G

ブラウザ上で動画アップロード → Webアプリ（Vercel上） → Gemini APIへ分析リクエスト → 結果をDB保存
分析完了後、WebアプリはDBから結果取得し表示
4. API定義
認証なし（デモ版のため）。すべてのAPIは公開エンドポイントとする。

エンドポイント	メソッド	説明	リクエストボディ	レスポンスボディ
/api/videos	GET	アップロード済み動画の分析結果一覧を取得	なし	[{videoId, analysisDate, evaluationData (JSON), videoUrl, status}]
/api/videos/{videoId}	GET	特定の動画分析結果を取得	なし	{videoId, analysisDate, evaluationData, videoUrl, status}
/api/videos/upload	POST	動画ファイルをアップロードし分析開始	form-data（動画ファイル）	{status: 200, message: '分析開始', videoId}
/api/admin/evaluations	GET	現在の評価項目一覧を取得	なし	[{id, item, point_3, point_2, point_1}]
/api/admin/evaluations	POST	評価項目を更新（追加・編集・削除含む）	[{id, item, point_3, point_2, point_1}]	{status: 200, message: '更新完了'}
/api/admin/prompts	GET	現在のプロンプト取得	なし	{ prompt: '...' }
/api/admin/prompts	POST	プロンプト更新	{ prompt: '...' }	{status: 200, message: '更新完了'}
補足:

statusカラムは動画分析状態（例：pending、analyzing、completed、error）を示す。
/api/videos/upload後、バックエンドで非同期的にGemini APIへ分析を投げ、完了時にDB更新。
クライアント側は/api/videosや/api/videos/{videoId}をポーリングすることで進捗確認。
5. DB設計
ユーザーテーブルは廃止（ログイン無し）。
動画分析結果と、評価項目、プロンプトを管理。

テーブル: videos

カラム名	データ型	制約	説明
id	INT	PK, AI	動画ID（分析結果ID）
video_url	TEXT		分析対象動画のURL
analysis_date	TIMESTAMP		分析完了日時
evaluation_data	JSON		構造化された分析結果データ
status	VARCHAR(50)		分析状態(pending, analyzing, completed, error等)
created_at	TIMESTAMP		作成日時
updated_at	TIMESTAMP		更新日時
テーブル: evaluation_items

カラム名	データ型	制約	説明
id	INT	PK, AI	評価項目ID
item	VARCHAR(255)	UNIQUE	評価項目名
point_3	VARCHAR(255)		3点評価時の説明
point_2	VARCHAR(255)		2点評価時の説明
point_1	VARCHAR(255)		1点評価時の説明
created_at	TIMESTAMP		作成日時
updated_at	TIMESTAMP		更新日時
テーブル: prompts

カラム名	データ型	制約	説明
id	INT	PK, AI	プロンプトID（1レコード想定）
prompt	TEXT		Geminiに渡すプロンプト全文
created_at	TIMESTAMP		作成日時
updated_at	TIMESTAMP		更新日時
6. Gemini API (Vertex AI) のプロンプトと構造化出力
プロンプト例（管理画面から可変）:

css
コードをコピーする
与えられた動画を分析し、以下の恋愛評価項目を採点してください。
評価項目は以下の通りです：
{{評価項目一覧}}

動画データ: {{video_data}}

結果はJSON形式で出力してください。
出力形式は以下:
{
  "評価結果": {
    {{評価結果}}
  },
  "総合評価": "...",
  "特に良かった点": "...",
  "改善が必要な点": "...",
  "次回への課題": "..."
}
構造化出力例:

json
コードをコピーする
{
  "評価結果": {
    "相手の話への傾聴と反応": {
      "点数": 3,
      "メモ": "深く理解を示す質問ができていた"
    },
    "自己開示のバランス": {
      "点数": 2,
      "メモ": "時々自慢が目立った"
    }
  },
  "総合評価": "概ね良い",
  "特に良かった点": "傾聴力",
  "改善が必要な点": "自己アピール過多",
  "次回への課題": "自己開示バランス調整"
}
Gemini APIのStructured Outputモードを使用し、指定フォーマットのJSONを取得する。
フロントでは、このJSONをパースして評価結果テーブルやグラフを表示。

7. フロントエンド・画面設計（デモ版 - 統合UI）
全機能を1つの「ダッシュボード画面」に統合し、分析結果詳細はモーダル表示または別ページで行う。URLによるページ分割は最小限。

画面一覧
ダッシュボード画面 ("/")

動画分析結果一覧（テーブル形式）
動画アップロード機能（ファイル選択→アップロードボタン）
評価項目編集機能（一覧表示、編集・削除、追加用フォーム）
プロンプト編集機能（テキストエリアと保存ボタン）
各分析結果行から詳細表示（/video/{videoId}）へ遷移可能
分析結果詳細画面 ("/video/{videoId}")

選択した動画の再生プレーヤー
評価結果詳細テーブル（各項目の点数・メモ）
総合評価、特に良かった点、改善点、次回課題などの表示
時系列グラフ（過去の評価推移を表示）
画面遷移
/（ダッシュボード）から動画詳細（/video/{videoId}）へリンクで遷移
それ以外にログイン画面などはなし
UI/UX方針
シンプルで直感的
PC/タブレット/スマホ対応（レスポンシブ）
全機能を1画面に集約しているため、タブやアコーディオン等を用いて整理
特別なユーザー認証がないため、アクセスした人は全機能操作可能
8. 非機能要件・その他
パフォーマンス: デモ用のため大規模負荷は想定せず。Vertex AI APIコールは同期呼び出し後、非同期で結果取得想定。
エラーハンドリング:
動画アップロード失敗時→エラー通知
Gemini API異常応答時→statusをerrorにし、フロントは適宜エラーメッセージを表示
評価項目/プロンプト更新失敗時→エラーメッセージ表示
ログ出力: デバッグ用ログ（APIコール結果、エラー内容）をVercel Functionsのログに出力。
セキュリティ: デモ用最低限。認証なしで誰でも編集可能であることを前提。
9. デモ版の目的・今後の展開
本デモ版は以下を目的とする：

基本コンセプト・UI・ワークフローの検証
Gemini APIを用いた動画分析結果取得の動作テスト
評価項目やプロンプト修正による分析結果変化の確認
将来的には以下を想定：

ユーザー登録・ログイン機能追加による個人化
アクセス制御・セキュリティ強化
分析結果の高度な可視化・グラフ化
追加評価項目、より詳細な分析アルゴリズムの導入
以上の改訂により、ログイン・会員登録なしで全機能がデモとして体験できる形に要件定義・設計をブラッシュアップしました。抜け漏れを減らし、非同期処理やエラーハンドリングについても明示的に言及しています。